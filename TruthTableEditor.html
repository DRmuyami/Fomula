<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truth Table Editor</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
        }
        .context-menu {
            display: none;
            position: absolute;
            background-color: #fff;
            border: 1px solid #ccc;
            z-index: 1000;
        }
        .context-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .context-menu ul li {
            padding: 8px 12px;
            cursor: pointer;
        }
        .context-menu ul li:hover {
            background-color: #eee;
        }
        .editable {
            cursor: pointer;
        }
        .editable:focus {
            outline: none;
            background-color: #eef;
        }
    </style>
</head>
<body>
    <h1>Truth Table Editor</h1>
    <table id="truthTable">
        <thead>
            <tr>
                <th>Element</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <!-- JavaScriptで行を追加 -->
        </tbody>
    </table>
    <button onclick="generateExpression()">Generate Expression</button>
    <div id="result"></div>

    <div class="context-menu" id="contextMenu">
        <ul>
            <li onclick="addRow()">Add Row</li>
            <li onclick="deleteRow()">Delete Row</li>
            <li onclick="addColumn()">Add Column</li>
            <li onclick="deleteColumn()">Delete Column</li>
        </ul>
    </div>

    <script>
        const truthTable = [
            { element: 'A', value: '1' },
            { element: 'B', value: '0' },
            // 他の要素を追加
        ];

        function renderTable() {
            const tbody = document.getElementById('truthTable').querySelector('tbody');
            tbody.innerHTML = '';
            truthTable.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                const tdElement = document.createElement('td');
                tdElement.textContent = row.element;
                const tdValue = document.createElement('td');
                tdValue.textContent = row.value;
                tdValue.classList.add('editable');
                tdValue.setAttribute('contenteditable', 'true');
                tdValue.addEventListener('focus', () => tdValue.textContent = '');
                tdValue.addEventListener('beforeinput', (e) => handleBeforeInput(e, rowIndex, tdValue));
                tr.appendChild(tdElement);
                tr.appendChild(tdValue);
                tbody.appendChild(tr);
            });
        }

        function handleBeforeInput(event, rowIndex, cell) {
            const validKeys = ['0', '1', 'x'];
            const inputValue = event.data;
            if (validKeys.includes(inputValue)) {
                truthTable[rowIndex].value = inputValue;
                //cell.textContent = inputValue;
            } else {
                event.preventDefault();
            }
        }

        function generateExpression() {
            // 論理式生成のロジックをここに追加
            const result = 'Generated Expression';
            document.getElementById('result').textContent = result;
        }

        function addRow() {
            truthTable.push({ element: 'New', value: 'x' });
            renderTable();
        }

        function deleteRow() {
            truthTable.pop();
            renderTable();
        }

        function addColumn() {
            // 列の追加ロジックをここに追加
            alert('Add Column functionality is not implemented yet.');
        }

        function deleteColumn() {
            // 列の削除ロジックをここに追加
            alert('Delete Column functionality is not implemented yet.');
        }

        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.style.top = `${e.pageY}px`;
            contextMenu.style.left = `${e.pageX}px`;
            contextMenu.style.display = 'block';
        });

        document.addEventListener('click', function() {
            document.getElementById('contextMenu').style.display = 'none';
        });

        renderTable();
    </script>
</body>
</html>
